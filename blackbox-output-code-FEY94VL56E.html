{% extends "base.html" %}

{% block content %}
    <main class="container">
        <h2>Your Cart</h2>
        {% if cart %}
            <div class="cart-items">
                {% for item in cart %}
                    <div class="cart-item">
                        <img src="{{ url_for('static', filename='images/' + item.image) }}" alt="{{ item.name }}" class="cart-image">
                        <div class="cart-details">
                            <h3>{{ item.name }}</h3>
                            <p>${{ "%.2f"|format(item.price) }} x <input type="number" value="{{ item.quantity }}" min="0" onchange="updateQuantity({{ item.id }}, this.value)" class="quantity-input"></p>
                        </div>
                        <a href="{{ url_for('remove_from_cart', product_id=item.id) }}" class="remove-btn">Remove</a>
                    </div>
                {% endfor %}
            </div>
            <div class="cart-total">
                <h3>Total: ${{ "%.2f"|format(total) }}</h3>
                <button class="checkout-btn">Checkout</button> <!-- Placeholder; integrate payment here -->
            </div>
        {% else %}
            <p>Your cart is empty. <a href="{{ url_for('index') }}">Start shopping!</a></p>
        {% endif %}
    </main>

    {% block scripts %}
        <script>
            function updateQuantity(productId, quantity) {
                fetch('/update_cart', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({product_id: productId, quantity: quantity})
                }).then(response => response.json())
                  .then(data => {
                      // Update total display (add DOM manipulation if needed)
                      location.reload();  // Simple reload for demo
                  });
            }
        </script>
    {% endblock %}
{% endblock %}